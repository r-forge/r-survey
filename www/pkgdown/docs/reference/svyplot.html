<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plots for survey data — svyplot • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Plots for survey data — svyplot"><meta property="og:description" content="Because observations in survey samples may represent very different
  numbers of units in the population ordinary plots can be misleading.
  The svyplot function produces scatterplots adjusted in various ways
  for sampling weights."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plots for survey data</h1>
    
    <div class="hidden name"><code>svyplot.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Because observations in survey samples may represent very different
  numbers of units in the population ordinary plots can be misleading.
  The <code>svyplot</code> function produces scatterplots adjusted in various ways
  for sampling weights.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">formula</span>, <span class="va">design</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for default</span></span>
<span><span class="fu">svyplot</span><span class="op">(</span><span class="va">formula</span>, <span class="va">design</span>, style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bubble"</span>, <span class="st">"hex"</span>, <span class="st">"grayhex"</span>,<span class="st">"subsample"</span>,<span class="st">"transparent"</span><span class="op">)</span>,</span>
<span>sample.size <span class="op">=</span> <span class="fl">500</span>, subset <span class="op">=</span> <span class="cn">NULL</span>, legend <span class="op">=</span> <span class="fl">1</span>, inches <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>amount<span class="op">=</span><span class="cn">NULL</span>, basecol<span class="op">=</span><span class="st">"black"</span>,</span>
<span>alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span>,xbins<span class="op">=</span><span class="fl">30</span>,<span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>A model formula</p></dd>

  <dt>design</dt>
<dd><p>A survey object (svydesign or svrepdesign)</p></dd>

  <dt>style</dt>
<dd><p>See Details below</p></dd>

  <dt>sample.size</dt>
<dd><p>For <code>style="subsample"</code></p></dd>

  <dt>subset</dt>
<dd><p>expression using variables in the design object</p></dd>

  <dt>legend</dt>
<dd><p>For <code>style="hex"</code> or <code>"grayhex"</code></p></dd>

  <dt>inches</dt>
<dd><p>Scale for bubble plots</p></dd>

  <dt>amount</dt>
<dd><p>list with <code>x</code> and <code>y</code> components for amount of
    jittering to use in subsample plots, or <code>NULL</code> for the default
    amount</p></dd>

  <dt>basecol</dt>
<dd><p>base color for transparent plots, or a function to
    compute the color (see below), or color for bubble plots</p></dd>

  <dt>alpha</dt>
<dd><p>minimum and maximum opacity for transparent plots</p></dd>

<dt>xbins</dt>
<dd><p>Number of (x-axis) bins for hexagonal binning</p></dd>

  <dt>...</dt>
<dd><p>Passed to <code>plot</code> methods</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Bubble plots are scatterplots with circles whose area is proportional
  to the sampling weight.  The two "hex" styles produce hexagonal
  binning scatterplots, and require the <code>hexbin</code> package from
  Bioconductor. The "transparent" style plots points with opacity
  proportional to sampling weight.</p>
  
<p>The <code>subsample</code> method uses the sampling weights to create a
  sample from approximately the population distribution and passes this to <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></code></p>  
<p>Bubble plots are suited to small surveys, hexagonal binning and
  transparency to large surveys where plotting all the points would
  result in too much overlap.</p>
<p><code>basecol</code> can be a function taking one data frame argument, which
  will be passed the data frame of variables from the survey object.
  This could be memory-intensive for large data sets.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>None</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/graphics/symbols.html" class="external-link">symbols</a></code> for other options (such as colour) for bubble
  plots.</p>
<p><code><a href="svychisq.html">svytable</a></code> for plots of discrete data.</p></div>
    </div>
    <div id="references">
    <h2>References</h2>
    

<p>Korn EL, Graubard BI (1998) "Scatterplots with Survey Data" The American Statistician 52: 58-69</p>
<p>Lumley T, Scott A (2017) "Fitting Regression Models to Survey Data"
Statistical Science 32: 265-278</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dstrat</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,strata<span class="op">=</span><span class="op">~</span><span class="va">stype</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apistrat</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>, style<span class="op">=</span><span class="st">"bubble"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>, style<span class="op">=</span><span class="st">"transparent"</span>,pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## these two require the hexbin package </span></span></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>, style<span class="op">=</span><span class="st">"hex"</span>, xlab<span class="op">=</span><span class="st">"1999 API"</span>,ylab<span class="op">=</span><span class="st">"2000 API"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>, style<span class="op">=</span><span class="st">"grayhex"</span>,legend<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dclus2</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span><span class="op">+</span><span class="va">snum</span>,  weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>,</span></span>
<span class="r-in"><span>                    data<span class="op">=</span><span class="va">apiclus2</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc1</span><span class="op">+</span><span class="va">fpc2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dclus2</span>, style<span class="op">=</span><span class="st">"subsample"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dclus2</span>, style<span class="op">=</span><span class="st">"subsample"</span>,</span></span>
<span class="r-in"><span>          amount<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">25</span>,y<span class="op">=</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>,</span></span>
<span class="r-in"><span>  basecol<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"goldenrod"</span>,<span class="st">"tomato"</span>,<span class="st">"sienna"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">stype</span><span class="op">)</span><span class="op">]</span><span class="op">}</span>,</span></span>
<span class="r-in"><span>  style<span class="op">=</span><span class="st">"transparent"</span>,pch<span class="op">=</span><span class="fl">19</span>,alpha<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"goldenrod"</span>,<span class="st">"tomato"</span>,<span class="st">"sienna"</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">19</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span>,<span class="st">"H"</span>,<span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For discrete data, estimate a population table and plot the table.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="svychisq.html">svytable</a></span><span class="op">(</span><span class="op">~</span><span class="va">sch.wide</span><span class="op">+</span><span class="va">comp.imp</span><span class="op">+</span><span class="va">stype</span>,design<span class="op">=</span><span class="va">dstrat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/fourfoldplot.html" class="external-link">fourfoldplot</a></span><span class="op">(</span><span class="fu"><a href="svychisq.html">svytable</a></span><span class="op">(</span><span class="op">~</span><span class="va">sch.wide</span><span class="op">+</span><span class="va">comp.imp</span><span class="op">+</span><span class="va">stype</span>,design<span class="op">=</span><span class="va">dstrat</span>,round<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To draw on a hexbin plot you need grid graphics, eg,</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">h</span><span class="op">&lt;-</span><span class="fu">svyplot</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, design<span class="op">=</span><span class="va">dstrat</span>, style<span class="op">=</span><span class="st">"hex"</span>, xlab<span class="op">=</span><span class="st">"1999 API"</span>,ylab<span class="op">=</span><span class="st">"2000 API"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">&lt;-</span><span class="fu"><a href="svysmooth.html">svysmooth</a></span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>,design<span class="op">=</span><span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/grid/grid.lines.html" class="external-link">grid.polyline</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">api99</span><span class="op">$</span><span class="va">x</span>,<span class="va">s</span><span class="op">$</span><span class="va">api99</span><span class="op">$</span><span class="va">y</span>,vp<span class="op">=</span><span class="va">h</span><span class="op">$</span><span class="va">plot.vp</span><span class="op">@</span><span class="va">hexVp.on</span>,default.units<span class="op">=</span><span class="st">"native"</span>, </span></span>
<span class="r-in"><span>   gp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="svyplot-10.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

