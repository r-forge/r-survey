<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute variances by replicate weighting — withReplicates • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute variances by replicate weighting — withReplicates"><meta property="og:description" content="Given a function or expression computing a statistic based on sampling
weights, withReplicates evaluates the statistic and produces a
replicate-based estimate of variance. vcov.svrep.design produces
the variance estimate from a set of replicates and the design object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute variances by replicate weighting</h1>
    
    <div class="hidden name"><code>withReplicates.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a function or expression computing a statistic based on sampling
weights, <code>withReplicates</code> evaluates the statistic and produces a
replicate-based estimate of variance. <code>vcov.svrep.design</code> produces
the variance estimate from a set of replicates and the design object.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta</span>,<span class="va">...</span>, return.replicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyrep.design</span></span>
<span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta</span>, rho <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>, </span>
<span>     scale.weights<span class="op">=</span><span class="cn">FALSE</span>, return.replicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svrepvar</span></span>
<span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta</span>,  <span class="va">...</span>,  return.replicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svrepstat</span></span>
<span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta</span>,  <span class="va">...</span>,  return.replicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyimputationList</span></span>
<span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">design</span>, <span class="va">theta</span>,  <span class="va">...</span>,  return.replicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyrep.design</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">replicates</span>, <span class="va">centre</span>,<span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>design</dt>
<dd><p>A survey design with replicate weights (eg from <code><a href="svrepdesign.html">svrepdesign</a></code>) or a suitable object with replicate parameter estimates</p></dd>

  <dt>theta</dt>
<dd><p>A function or expression: see Details below</p></dd>

  <dt>rho</dt>
<dd><p>If <code>design</code> uses BRR weights, <code>rho</code> optionally
    specifies the parameter for Fay's variance estimator.</p></dd>

  <dt>...</dt>
<dd><p>Other arguments to <code>theta</code></p></dd>

  <dt>scale.weights</dt>
<dd><p>Divide the probability weights by their sum (can
    help with overflow problems)</p></dd>

  <dt>return.replicates</dt>
<dd><p>Return the replicate estimates as well as
    the variance?</p></dd>

    <dt>object</dt>
<dd><p>The replicate-weights design object used to create the replicates</p></dd>

    <dt>replicates</dt>
<dd><p>A set of replicates</p></dd>

    <dt>centre</dt>
<dd><p>The centering value for variance calculation. If
      <code>object$mse</code> is <code>TRUE</code> 
      this is the result of estimation using the sampling weights, and
      must be supplied.  If  <code>object$mse</code> is <code>FALSE</code> the
      mean of the replicates is used and this argument is silently ignored.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The method for <code>svyrep.design</code> objects evaluates a function or
expression using the sampling weights and then each set of replicate
weights.  The method for <code>svrepvar</code> objects evaluates the function
or expression on an estimated population covariance matrix and its
replicates, to simplify multivariate statistics such as structural
equation models.</p>
<p>For the <code>svyrep.design</code> method, if <code>theta</code> is a function its first argument will be a vector of
  weights and the second argument will be a data frame containing the
  variables from the design object.   If it is an expression, the sampling weights will be available as the
  variable <code>.weights</code>.  Variables in the design object will also
  be in scope.  It is possible to use global variables in the
  expression, but unwise, as they may be masked by local variables
  inside <code>withReplicates</code>.</p>
<p>For the <code>svrepvar</code> method a function will get the covariance
matrix as its first argument, and an expression will be evaluated with
<code>.replicate</code> set to the variance matrix.</p>
<p>For the <code>svrepstat</code> method a function will get the point estimate, and an expression will be evaluated with
<code>.replicate</code> set to each replicate.  The method can only be used
when the <code>svrepstat</code> object includes replicates.</p>
<p>The <code>svyimputationList</code> method runs <code>withReplicates</code> on each imputed design (which must be replicate-weight designs).</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>If <code>return.replicates=FALSE</code>,  the weighted statistic, with the
  variance matrix as the <code>"var"</code> attribute. If</p>
<p></p>
<p><code>return.replicates=TRUE</code>, a list with elements <code>theta</code> for
  the usual return value and <code>replicates</code> for the replicates.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="svrepdesign.html">svrepdesign</a></code>, <code><a href="as.svrepdesign.html">as.svrepdesign</a></code>, <code><a href="svrVar.html">svrVar</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">scd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">repweights</span><span class="op">&lt;-</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scdrep</span><span class="op">&lt;-</span><span class="fu"><a href="svrepdesign.html">svrepdesign</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">scd</span>, type<span class="op">=</span><span class="st">"BRR"</span>, repweights<span class="op">=</span><span class="va">repweights</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No sampling weights provided: equal probability assumed</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">a</span><span class="op">&lt;-</span><span class="fu"><a href="svyratio.html">svyratio</a></span><span class="op">(</span><span class="op">~</span><span class="va">alive</span>, <span class="op">~</span><span class="va">arrests</span>, design<span class="op">=</span><span class="va">scdrep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">ratio</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         arrests</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alive 0.1535064</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">var</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 8.870627e-05</span>
<span class="r-in"><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">scdrep</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.weights</span><span class="op">*</span><span class="va">alive</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">.weights</span><span class="op">*</span><span class="va">arrests</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        theta     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.15351 0.0094</span>
<span class="r-in"><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">scdrep</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span>,<span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">alive</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">*</span><span class="va">data</span><span class="op">$</span><span class="va">arrests</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        theta     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.15351 0.0094</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dclus1</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rclus1</span><span class="op">&lt;-</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dclus1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">varmat</span><span class="op">&lt;-</span><span class="fu"><a href="surveysummary.html">svyvar</a></span><span class="op">(</span><span class="op">~</span><span class="va">api00</span><span class="op">+</span><span class="va">api99</span><span class="op">+</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">hsg</span><span class="op">+</span><span class="va">mobility</span>,<span class="va">rclus1</span>,return.replicates<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">varmat</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/stats/factanal.html" class="external-link">factanal</a></span><span class="op">(</span>covmat<span class="op">=</span><span class="va">.replicate</span>, factors<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">unique</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             theta     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00    0.005000 0.0651</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api99    0.040393 0.0316</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell      0.452180 0.6865</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals    0.181142 0.0569</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hsg      0.995913 0.0409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility 0.930017 0.0488</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nhanes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nhanesdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">SDMVPSU</span>, strata<span class="op">=</span><span class="op">~</span><span class="va">SDMVSTRA</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">WTMEC2YR</span>, nest<span class="op">=</span><span class="cn">TRUE</span>,data<span class="op">=</span><span class="va">nhanes</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">HI_CHOL</span><span class="op">~</span><span class="va">race</span><span class="op">+</span><span class="va">agecat</span><span class="op">+</span><span class="va">RIAGENDR</span>, design<span class="op">=</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">nhanesdesign</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>family<span class="op">=</span><span class="va">quasibinomial</span>, return.replicates<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitted</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">logistic</span>, return.replicates<span class="op">=</span><span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sensitivity</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">pred</span>,<span class="va">actual</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">&gt;</span><span class="fl">0.1</span> <span class="op">&amp;</span> <span class="va">actual</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">actual</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">fitted</span>, <span class="va">sensitivity</span>, actual<span class="op">=</span><span class="va">logistic</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        theta     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.77891 0.0246</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org" class="external-link">quantreg</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## one-stage cluster sample</span></span></span>
<span class="r-in"><span><span class="va">dclus1</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## convert to bootstrap</span></span></span>
<span class="r-in"><span><span class="va">bclus1</span><span class="op">&lt;-</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dclus1</span>,type<span class="op">=</span><span class="st">"bootstrap"</span>, replicates<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## median regression</span></span></span>
<span class="r-in"><span><span class="fu">withReplicates</span><span class="op">(</span><span class="va">bclus1</span>, <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/quantreg/man/rq.html" class="external-link">rq</a></span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">api99</span>, tau<span class="op">=</span><span class="fl">0.5</span>, weights<span class="op">=</span><span class="va">.weights</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## pearson correlation</span></span></span>
<span class="r-in"><span><span class="va">dstrat</span> <span class="op">&lt;-</span> <span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,strata<span class="op">=</span><span class="op">~</span><span class="va">stype</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apistrat</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bstrat</span><span class="op">&lt;-</span> <span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dstrat</span>,type<span class="op">=</span><span class="st">"subbootstrap"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="surveysummary.html">svyvar</a></span><span class="op">(</span><span class="op">~</span><span class="va">api00</span><span class="op">+</span><span class="va">api99</span>, <span class="va">bstrat</span>, return.replicates<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vcor</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">vreps</span><span class="op">&lt;-</span><span class="va">v</span><span class="op">$</span><span class="va">replicates</span></span></span>
<span class="r-in"><span><span class="va">correps</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">vreps</span>,<span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="va">v</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">v</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">v</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">bstrat</span>,<span class="va">correps</span>, centre<span class="op">=</span><span class="va">vcor</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.73213e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"means")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9754495</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

