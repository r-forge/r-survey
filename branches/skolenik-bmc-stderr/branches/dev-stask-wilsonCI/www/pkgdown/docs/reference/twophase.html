<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Two-phase designs — twophase • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Two-phase designs — twophase"><meta property="og:description" content="In a two-phase design a sample is taken from a population and a
subsample taken from the sample, typically stratified by variables not
known for the whole population.  The second phase can use any design 
supported for single-phase sampling. The first phase must currently
be one-stage element  or cluster sampling"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Two-phase designs</h1>
    
    <div class="hidden name"><code>twophase.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>In a two-phase design a sample is taken from a population and a
subsample taken from the sample, typically stratified by variables not
known for the whole population.  The second phase can use any design 
supported for single-phase sampling. The first phase must currently
be one-stage element  or cluster sampling</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">twophase</span><span class="op">(</span><span class="va">id</span>, strata <span class="op">=</span> <span class="cn">NULL</span>, probs <span class="op">=</span> <span class="cn">NULL</span>, weights <span class="op">=</span> <span class="cn">NULL</span>, fpc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span><span class="va">subset</span>, <span class="va">data</span>, method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full"</span>,<span class="st">"approx"</span>,<span class="st">"simple"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">twophasevar</span><span class="op">(</span><span class="va">x</span>,<span class="va">design</span><span class="op">)</span></span>
<span><span class="fu">twophase2var</span><span class="op">(</span><span class="va">x</span>,<span class="va">design</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>id</dt>
<dd><p>list of two formulas for sampling unit identifiers</p></dd>

  <dt>strata</dt>
<dd><p>list of two formulas (or <code>NULL</code>s) for stratum identifies</p></dd>

  <dt>probs</dt>
<dd><p>list of two formulas (or <code>NULL</code>s) for sampling probabilities</p></dd>

  <dt>weights</dt>
<dd><p>Only for <code>method="approx"</code>, list of two formulas (or <code>NULL</code>s) for sampling weights</p></dd>

  <dt>fpc</dt>
<dd><p>list of two formulas (or <code>NULL</code>s) for finite
    population corrections</p></dd>

  <dt>subset</dt>
<dd><p>formula specifying which observations are selected in
    phase 2</p></dd>

  <dt>data</dt>
<dd><p>Data frame will all data for phase 1 and 2</p></dd>

  <dt>method</dt>
<dd><p><code>"full"</code> requires (much) more memory, but gives unbiased
    variance estimates for general multistage designs at both phases.
    <code>"simple"</code> or <code>"approx"</code> uses the standard error calculation from
    version 3.14 and earlier,  which uses much less memory and is correct for designs with simple
    random sampling at phase one and stratified random sampling at phase two.</p></dd>

  <dt>x</dt>
<dd><p>probability-weighted estimating functions</p></dd>

  <dt>design</dt>
<dd><p>two-phase design</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The population for the second phase is the first-phase sample. If the
  second phase sample uses stratified (multistage cluster) sampling
  without replacement and all the stratum and sampling unit identifier
  variables are available for the whole first-phase sample it is
  possible to estimate the sampling probabilities/weights and the
  finite population correction. These would then  be specified as
  <code>NULL</code>.</p>
<p>Two-phase case-control and case-cohort studies in biostatistics will
  typically have simple random sampling with replacement as the first
  stage. Variances given here may differ slightly from those in the
  biostatistics literature where a model-based estimator of the
  first-stage variance would typically be used.</p>  
<p>Variance computations are based on the conditioning argument in
  Section 9.3 of Sarndal et al. Method <code>"full"</code> corresponds exactly
  to the formulas in that reference. Method <code>"simple"</code> or
  <code>"approx"</code> (the two are the same) uses less time and memory but
  is exact only for some special cases. The most important special case
  is the two-phase epidemiologic designs where phase 1 is simple random
  sampling from an infinite population and phase 2 is stratified random
  sampling.  See the <code>tests</code> directory for a worked example. The
  only disadvantage of method="simple" in these cases is that
  standardization of margins (<code><a href="marginpred.html">marginpred</a></code>) is not available.</p>

<p>For <code>method="full"</code>, sampling probabilities must be available for
  each stage of sampling, within each phase.  For multistage sampling
  this requires specifying either <code>fpc</code> or <code>probs</code> as a
  formula with a term for each stage of sampling.  If no <code>fpc</code> or
  <code>probs</code> are specified at phase 1 it is treated as simple random
  sampling from an infinite population, and population totals will not
  be correctly estimated, but means, quantiles, and regression models
  will be correct.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p></p>
<p><code>twophase</code> returns an object of class <code>twophase2</code> (for</p>
<p></p>
<p><code>method="full"</code>) or <code>twophase</code>.  The structure of</p>
<p></p>
<p><code>twophase2</code> objects may change as unnecessary components are removed.</p>
<p></p>
<p><code>twophase2var</code> and <code>twophasevar</code> return a variance matrix with an attribute
  containing the separate phase 1 and phase 2 contributions to the variance.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Sarndal CE, Swensson B, Wretman J (1992) "Model Assisted Survey Sampling"
Springer.</p>

<p>Breslow NE and Chatterjee N, Design and analysis of two-phase
studies with binary outcome applied to Wilms tumour prognosis.  "Applied
Statistics"  48:457-68, 1999</p>
<p>Breslow N, Lumley T, Ballantyne CM, Chambless LE, Kulick M. (2009)
Improved Horvitz-Thompson estimation of model parameters from two-phase
stratified samples: applications in epidemiology. Statistics in
Biosciences. doi 10.1007/s12561-009-9001-6</p>

<p>Lin, DY and Ying, Z (1993). Cox regression with incomplete covariate measurements.
"Journal of the American Statistical Association" 88: 1341-1349.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="svydesign.html">svydesign</a></code>, <code><a href="svyrecvar.html">svyrecvar</a></code> for multi*stage*
  sampling</p>
<p><code><a href="calibrate.html">calibrate</a></code> for calibration (GREG) estimators.</p>
<p><code><a href="estweights.html">estWeights</a></code> for two-phase designs for missing data.</p>
<p>The "epi" and "phase1" vignettes for examples and technical details.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span> <span class="co">## two-phase simple random sampling.</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span>, package<span class="op">=</span><span class="st">"survival"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">pbc</span><span class="op">$</span><span class="va">randomized</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pbc</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">trt</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">pbc</span><span class="op">$</span><span class="va">id</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">d2pbc</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">id</span>,<span class="op">~</span><span class="va">id</span><span class="op">)</span>, data<span class="op">=</span><span class="va">pbc</span>, subset<span class="op">=</span><span class="op">~</span><span class="va">randomized</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">bili</span>, <span class="va">d2pbc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> bili 3.2561 0.2562</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## two-stage sampling as two-phase</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mu284</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">ii</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">mu284</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="va">n2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">mu284.1</span><span class="op">&lt;-</span><span class="va">mu284</span><span class="op">[</span><span class="va">ii</span>,<span class="op">]</span></span></span>
<span class="r-in"><span> <span class="va">mu284.1</span><span class="op">$</span><span class="va">id</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mu284.1</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">mu284.1</span><span class="op">$</span><span class="va">sub</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">34</span><span class="op">-</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dmu284</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">id1</span><span class="op">+</span><span class="va">id2</span>,fpc<span class="op">=</span><span class="op">~</span><span class="va">n1</span><span class="op">+</span><span class="va">n2</span>, data<span class="op">=</span><span class="va">mu284</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co">## first phase cluster sample, second phase stratified within cluster</span></span></span>
<span class="r-in"><span> <span class="va">d2mu284</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">id1</span>,<span class="op">~</span><span class="va">id</span><span class="op">)</span>,strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="op">~</span><span class="va">id1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     fpc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">n1</span>,<span class="cn">NULL</span><span class="op">)</span>,data<span class="op">=</span><span class="va">mu284.1</span>,subset<span class="op">=</span><span class="op">~</span><span class="va">sub</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">y1</span>, <span class="va">dmu284</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    total     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y1 15080 2274.3</span>
<span class="r-in"><span> <span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">y1</span>, <span class="va">d2mu284</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    total     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y1 15080 2274.3</span>
<span class="r-in"><span> <span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">y1</span>, <span class="va">dmu284</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y1 44.353 2.2737</span>
<span class="r-in"><span> <span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">y1</span>, <span class="va">d2mu284</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> y1 44.353 2.2737</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## case-cohort design: this example requires R 2.2.0 or later</span></span></span>
<span class="r-in"><span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/therneau/survival" class="external-link">"survival"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nwtco</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## stratified on case status</span></span></span>
<span class="r-in"><span> <span class="va">dcchs</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">seqno</span>,<span class="op">~</span><span class="va">seqno</span><span class="op">)</span>, strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="op">~</span><span class="va">rel</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>         subset<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">in.subcohort</span> <span class="op">|</span> <span class="va">rel</span><span class="op">)</span>, data<span class="op">=</span><span class="va">nwtco</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="svycoxph.html">svycoxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">edrel</span>,<span class="va">rel</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>, design<span class="op">=</span><span class="va">dcchs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svycoxph(formula = Surv(edrel, rel) ~ factor(stage) + factor(histol) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     I(age/12), design = dcchs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    coef exp(coef) se(coef) robust se      z        p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2  0.69266   1.99902  0.22688   0.16279  4.255 2.09e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3  0.62685   1.87171  0.22873   0.16823  3.726 0.000194</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4  1.29951   3.66751  0.25017   0.18898  6.877 6.13e-12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2 1.45829   4.29861  0.16844   0.14548 10.024  &lt; 2e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> I(age/12)       0.04609   1.04717  0.02732   0.02302  2.002 0.045233</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test=  on 5 df, p=</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n= 1154, number of events= 571 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Using survival::cch </span></span></span>
<span class="r-in"><span> <span class="va">subcoh</span> <span class="op">&lt;-</span> <span class="va">nwtco</span><span class="op">$</span><span class="va">in.subcohort</span></span></span>
<span class="r-in"><span> <span class="va">selccoh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">nwtco</span>, <span class="va">rel</span><span class="op">==</span><span class="fl">1</span><span class="op">|</span><span class="va">subcoh</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">ccoh.data</span> <span class="op">&lt;-</span> <span class="va">nwtco</span><span class="op">[</span><span class="va">selccoh</span>,<span class="op">]</span></span></span>
<span class="r-in"><span> <span class="va">ccoh.data</span><span class="op">$</span><span class="va">subcohort</span> <span class="op">&lt;-</span> <span class="va">subcoh</span><span class="op">[</span><span class="va">selccoh</span><span class="op">]</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/cch.html" class="external-link">cch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">edrel</span>, <span class="va">rel</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">/</span><span class="fl">12</span><span class="op">)</span>, data <span class="op">=</span><span class="va">ccoh.data</span>,</span></span>
<span class="r-in"><span>        subcoh <span class="op">=</span> <span class="op">~</span><span class="va">subcohort</span>, id<span class="op">=</span><span class="op">~</span><span class="va">seqno</span>, cohort.size<span class="op">=</span><span class="fl">4028</span>, method<span class="op">=</span><span class="st">"LinYing"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Case-cohort analysis,x$method, LinYing </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  with subcohort of 668 from cohort of 4028 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call: cch(formula = Surv(edrel, rel) ~ factor(stage) + factor(histol) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     I(age/12), data = ccoh.data, subcoh = ~subcohort, id = ~seqno, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cohort.size = 4028, method = "LinYing")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      Value         SE         Z            p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2  0.69265646 0.16287906  4.252581 2.113204e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3  0.62685179 0.16746144  3.743260 1.816478e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4  1.29951229 0.18973707  6.849016 7.436052e-12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2 1.45829267 0.14429553 10.106291 0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> I(age/12)       0.04608972 0.02230861  2.066006 3.882790e-02</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## two-phase case-control</span></span></span>
<span class="r-in"><span> <span class="co">## Similar to Breslow &amp; Chatterjee, Applied Statistics (1999) but with</span></span></span>
<span class="r-in"><span> <span class="co">## a slightly different version of the data set</span></span></span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span> <span class="va">nwtco</span><span class="op">$</span><span class="va">incc2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">nwtco</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">rel</span> <span class="op">|</span> <span class="va">instit</span><span class="op">==</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nwtco</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fl">.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dccs2</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">seqno</span>,<span class="op">~</span><span class="va">seqno</span><span class="op">)</span>,strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">rel</span>,<span class="va">instit</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    data<span class="op">=</span><span class="va">nwtco</span>, subset<span class="op">=</span><span class="op">~</span><span class="va">incc2</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">dccs8</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">seqno</span>,<span class="op">~</span><span class="va">seqno</span><span class="op">)</span>,strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">rel</span>,<span class="va">stage</span>,<span class="va">instit</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    data<span class="op">=</span><span class="va">nwtco</span>, subset<span class="op">=</span><span class="op">~</span><span class="va">incc2</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,data<span class="op">=</span><span class="va">nwtco</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = rel ~ factor(stage) * factor(histol), family = binomial(), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data = nwtco)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Deviance Residuals: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min       1Q   Median       3Q      Max  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.5829  -0.5243  -0.5230  -0.3626   2.3472  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6890     0.1077 -24.958  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7687     0.1457   5.274 1.34e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7741     0.1508   5.133 2.86e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0422     0.1748   5.964 2.46e-09 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.2928     0.2480   5.213 1.86e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.1737     0.3255   0.534  0.59362    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.6503     0.3175   2.048  0.04056 *  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.2703     0.3879   3.275  0.00106 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for binomial family taken to be 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Null deviance: 3288.0  on 4027  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual deviance: 2924.3  on 4020  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 2940.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,design<span class="op">=</span><span class="va">dccs2</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = rel ~ factor(stage) * factor(histol), design = dccs2, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> twophase2(id = id, strata = strata, probs = probs, fpc = fpc, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     subset = subset, data = data)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6542     0.1251 -21.218  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7001     0.1960   3.572 0.000369 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7116     0.2038   3.492 0.000498 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0321     0.2515   4.104 4.34e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.1427     0.3170   3.605 0.000326 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.4313     0.4408   0.978 0.328054    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.7362     0.4256   1.730 0.083981 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.8265     0.4927   3.707 0.000220 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.000873)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,design<span class="op">=</span><span class="va">dccs8</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = rel ~ factor(stage) * factor(histol), design = dccs8, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> twophase2(id = id, strata = strata, probs = probs, fpc = fpc, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     subset = subset, data = data)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6789     0.1089 -24.594  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7515     0.1474   5.097 4.04e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7727     0.1528   5.057 4.98e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0109     0.1753   5.767 1.04e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.1565     0.3170   3.648 0.000277 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.3986     0.4328   0.921 0.357243    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.6956     0.4156   1.674 0.094455 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.8586     0.4651   3.996 6.85e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.000873)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Stratification on stage is really post-stratification, so we should use calibrate()</span></span></span>
<span class="r-in"><span> <span class="va">gccs8</span><span class="op">&lt;-</span><span class="fu"><a href="calibrate.html">calibrate</a></span><span class="op">(</span><span class="va">dccs2</span>, phase<span class="op">=</span><span class="fl">2</span>, formula<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">rel</span>,<span class="va">stage</span>,<span class="va">instit</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,design<span class="op">=</span><span class="va">gccs8</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = rel ~ factor(stage) * factor(histol), design = gccs8, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> calibrate(dccs2, phase = 2, formula = ~interaction(rel, stage, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     instit))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6789     0.1090 -24.577  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7515     0.1474   5.099 4.00e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7727     0.1527   5.061 4.87e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0109     0.1758   5.752 1.13e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.1565     0.3168   3.651 0.000273 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.3986     0.4321   0.922 0.356551    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.6956     0.4149   1.676 0.093922 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.8586     0.4650   3.997 6.84e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.000873)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## For this saturated model calibration is equivalent to estimating weights.</span></span></span>
<span class="r-in"><span> <span class="va">pccs8</span><span class="op">&lt;-</span><span class="fu"><a href="calibrate.html">calibrate</a></span><span class="op">(</span><span class="va">dccs2</span>, phase<span class="op">=</span><span class="fl">2</span>,formula<span class="op">=</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">rel</span>,<span class="va">stage</span>,<span class="va">instit</span><span class="op">)</span>, calfun<span class="op">=</span><span class="st">"rrz"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,design<span class="op">=</span><span class="va">pccs8</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = rel ~ factor(stage) * factor(histol), design = pccs8, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> calibrate(dccs2, phase = 2, formula = ~interaction(rel, stage, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     instit), calfun = "rrz")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6789     0.1090 -24.577  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7515     0.1474   5.099 4.00e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7727     0.1527   5.061 4.87e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0109     0.1758   5.752 1.13e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.1565     0.3168   3.651 0.000273 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.3986     0.4321   0.922 0.356551    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.6956     0.4149   1.676 0.093922 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.8586     0.4650   3.997 6.84e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.000873)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="co">## Since sampling is SRS at phase 1 and stratified RS at phase 2, we</span></span></span>
<span class="r-in"><span> <span class="co">## can use method="simple" to save memory.</span></span></span>
<span class="r-in"><span> <span class="va">dccs8_simple</span><span class="op">&lt;-</span><span class="fu">twophase</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">seqno</span>,<span class="op">~</span><span class="va">seqno</span><span class="op">)</span>,strata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>,<span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">rel</span>,<span class="va">stage</span>,<span class="va">instit</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    data<span class="op">=</span><span class="va">nwtco</span>, subset<span class="op">=</span><span class="op">~</span><span class="va">incc2</span>,method<span class="op">=</span><span class="st">"simple"</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">rel</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">stage</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">histol</span><span class="op">)</span>,design<span class="op">=</span><span class="va">dccs8_simple</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = rel ~ factor(stage) * factor(histol), design = dccs8_simple, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> twophase(id = list(~seqno, ~seqno), strata = list(NULL, ~interaction(rel, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stage, instit)), data = nwtco, subset = ~incc2, method = "simple")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)                     -2.6789     0.1089 -24.591  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2                   0.7515     0.1474   5.097 4.06e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3                   0.7727     0.1528   5.056 5.00e-07 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4                   1.0109     0.1753   5.766 1.05e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(histol)2                  1.1565     0.3171   3.648 0.000277 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)2:factor(histol)2   0.3986     0.4328   0.921 0.357276    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)3:factor(histol)2   0.6956     0.4156   1.674 0.094479 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(stage)4:factor(histol)2   1.8586     0.4651   3.996 6.86e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.000873)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

