<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Survey-weighted generalised linear models. — svyglm • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Survey-weighted generalised linear models. — svyglm"><meta property="og:description" content="Fit a generalised linear model to data from a complex survey design,
with inverse-probability weighting and design-based standard errors."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Survey-weighted generalised linear models.</h1>
    
    <div class="hidden name"><code>svyglm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a generalised linear model to data from a complex survey design,
with inverse-probability weighting and design-based standard errors.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for survey.design</span></span>
<span><span class="fu">svyglm</span><span class="op">(</span><span class="va">formula</span>, <span class="va">design</span>, subset<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>family<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,start<span class="op">=</span><span class="cn">NULL</span>, rescale<span class="op">=</span><span class="cn">TRUE</span>, <span class="va">...</span>, deff<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span> influence<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyrep.design</span></span>
<span><span class="fu">svyglm</span><span class="op">(</span><span class="va">formula</span>, <span class="va">design</span>, subset<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>family<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,start<span class="op">=</span><span class="cn">NULL</span>, rescale<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span>, rho<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>return.replicates<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">na.action</span>,multicore<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"survey.multicore"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyglm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, correlation <span class="op">=</span> <span class="cn">FALSE</span>, df.resid<span class="op">=</span><span class="cn">NULL</span>,</span>
<span><span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyglm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>,newdata<span class="op">=</span><span class="cn">NULL</span>,total<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                         type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"link"</span>,<span class="st">"response"</span>,<span class="st">"terms"</span><span class="op">)</span>,</span>
<span>                         se.fit<span class="op">=</span><span class="op">(</span><span class="va">type</span> <span class="op">!=</span> <span class="st">"terms"</span><span class="op">)</span>,vcov<span class="op">=</span><span class="cn">FALSE</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svrepglm</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>,newdata<span class="op">=</span><span class="cn">NULL</span>,total<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                         type<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"link"</span>,<span class="st">"response"</span>,<span class="st">"terms"</span><span class="op">)</span>,</span>
<span>                         se.fit<span class="op">=</span><span class="op">(</span><span class="va">type</span> <span class="op">!=</span> <span class="st">"terms"</span><span class="op">)</span>,vcov<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                         return.replicates<span class="op">=</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">replicates</span><span class="op">)</span>,<span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>Model formula</p></dd>

  <dt>design</dt>
<dd><p>Survey design from <code><a href="svydesign.html">svydesign</a></code> or <code><a href="svrepdesign.html">svrepdesign</a></code>. Must contain all variables
    in the formula</p></dd>

  <dt>subset</dt>
<dd><p>Expression to select a subpopulation</p></dd>

  <dt>family</dt>
<dd><p><code>family</code> object for <code>glm</code></p></dd>

  <dt>start</dt>
<dd><p>Starting values for the coefficients (needed for some
    uncommon link/family combinations)</p></dd>

  <dt>rescale</dt>
<dd><p>Rescaling of weights, to improve numerical stability. The default
    rescales weights to sum to the sample size. Use <code>FALSE</code> to not
    rescale weights. For replicate-weight designs, use <code>TRUE</code> to
    rescale weights to sum to 1, as was the case before version 3.34.</p></dd>

  <dt>...</dt>
<dd><p>Other arguments passed to <code>glm</code> or
    <code>summary.glm</code></p></dd>

  <dt>rho</dt>
<dd><p>For replicate BRR designs, to specify the parameter for
    Fay's variance method, giving weights of <code>rho</code> and <code>2-rho</code></p></dd>

  <dt>return.replicates</dt>
<dd><p>Return the replicates as the <code>replicates</code> component of the
    result? (for <code>predict</code>, only possible if they
    were computed in the <code>svyglm</code> fit)</p></dd>

  <dt>deff</dt>
<dd><p>Estimate the design effects</p></dd>

  <dt>influence</dt>
<dd><p>Return influence functions</p></dd>

  <dt>object</dt>
<dd><p>A <code>svyglm</code> object</p></dd>

  <dt>correlation</dt>
<dd><p>Include the correlation matrix of parameters?</p></dd>

  <dt>na.action</dt>
<dd><p>Handling of NAs</p></dd>

  <dt>multicore</dt>
<dd><p>Use the <code>multicore</code> package to distribute
    replicates across processors?</p></dd>
	      
  <dt>df.resid</dt>
<dd><p>Optional denominator degrees of freedom for Wald
    tests</p></dd>

  <dt>newdata</dt>
<dd><p>new data frame for prediction</p></dd>

  <dt>total</dt>
<dd><p>population size when predicting population total</p></dd>

  <dt>type</dt>
<dd><p>linear predictor (<code>link</code>) or response</p></dd>

  <dt>se.fit</dt>
<dd><p>if <code>TRUE</code>, return variances of predictions</p></dd>

  <dt>vcov</dt>
<dd><p>if <code>TRUE</code> and <code>se=TRUE</code> return full
    variance-covariance matrix of predictions</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>For binomial and Poisson families use <code>family=quasibinomial()</code>
and <code>family=quasipoisson()</code> to avoid a warning about non-integer
numbers of successes.  The `quasi' versions of the family objects give
the same point estimates and standard errors and do not give the
warning.</p>
<p>If <code>df.resid</code> is not specified the df for the null model is
computed by <code><a href="svychisq.html">degf</a></code> and the residual df computed by
subtraction.  This is recommended by Korn and Graubard and is correct
for PSU-level covariates but is potentially very conservative for
individual-level covariates. To get tests based on a Normal distribution
use <code>df.resid=Inf</code>, and to use number of PSUs-number of strata,
specify <code>df.resid=degf(design)</code>.</p>
<p>Parallel processing with <code>multicore=TRUE</code> is helpful only for
fairly large data sets and on computers with sufficient memory. It may
be incompatible with GUIs, although the Mac Aqua GUI appears to be safe.</p>
<p><code>predict</code> gives fitted values and sampling variability for specific new
values of covariates.  When <code>newdata</code> are the population mean it
gives the regression estimator of the mean, and when <code>newdata</code> are
the population totals and <code>total</code> is specified it gives the
regression estimator of the population total.  Regression estimators of
mean and total can also be obtained with <code><a href="calibrate.html">calibrate</a></code>.</p>


    </div>
    <div id="note">
    <h2>Note</h2>
    <p><code>svyglm</code> always returns 'model-robust' standard errors; the
Horvitz-Thompson-type standard errors used everywhere in the survey
package are a generalisation of the model-robust 'sandwich' estimators.
In particular, a quasi-Poisson <code>svyglm</code> will return correct
standard errors for relative risk regression models.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>This function does not return the same standard error estimates for the
regression estimator of population mean and total as some textbooks, or
SAS.  However, it does give the same standard error estimator as
estimating the mean or total with calibrated weights.</p>
<p>In particular, under simple random sampling with or without replacement
there is a simple rescaling of the mean squared residual to estimate the
mean squared error of the regression estimator.   The standard error
estimate produced by <code>predict.svyglm</code> has very similar
(asymptotically identical) expected
value to the textbook estimate, and has the advantage of being
applicable when the supplied <code>newdata</code> are not the population mean
of the predictors. The difference is small when the sample size is large, but can be
appreciable for small samples.</p>
<p>You can obtain the other standard error estimator by calling
<code>predict.svyglm</code> with the covariates set to their estimated (rather
than true) population mean values.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p></p>
<p><code>svyglm</code> returns an object of class <code>svyglm</code>.  The</p>
<p></p>
<p><code>predict</code> method returns an object of class <code>svystat</code></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Thomas Lumley</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>, which is used to do most of the work.</p>  
<p><code><a href="regTermTest.html">regTermTest</a></code>, for multiparameter tests</p>
<p><code><a href="calibrate.html">calibrate</a></code>, for an alternative way to specify regression
  estimators of population totals or means</p>
<p><code><a href="svyttest.html">svyttest</a></code> for one-sample and two-sample t-tests.</p></div>
    </div>
    <div id="references">
    <h2>References</h2>
    

<p>Lumley T, Scott A (2017) "Fitting Regression Models to Survey Data"
Statistical Science 32: 265-278</p>
<p></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">dstrat</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,strata<span class="op">=</span><span class="op">~</span><span class="va">stype</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apistrat</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dclus2</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span><span class="op">+</span><span class="va">snum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">rstrat</span><span class="op">&lt;-</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">rclus2</span><span class="op">&lt;-</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dclus2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">svyglm</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">mobility</span>, design<span class="op">=</span><span class="va">dstrat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = api00 ~ ell + meals + mobility, design = dstrat)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svydesign(id = ~1, strata = ~stype, weights = ~pw, data = apistrat, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fpc = ~fpc)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 820.8873    10.0777  81.456   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell          -0.4806     0.3920  -1.226    0.222    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals        -3.1415     0.2839 -11.064   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility      0.2257     0.3932   0.574    0.567    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for gaussian family taken to be 5171.966)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">svyglm</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">mobility</span>, design<span class="op">=</span><span class="va">dclus2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = api00 ~ ell + meals + mobility, design = dclus2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svydesign(id = ~dnum + snum, weights = ~pw, data = apiclus2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 811.4907    30.8795  26.279   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell          -2.0592     1.4075  -1.463    0.152    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals        -1.7772     1.1053  -1.608    0.117    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility      0.3253     0.5305   0.613    0.544    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for gaussian family taken to be 8363.101)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">svyglm</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">mobility</span>, design<span class="op">=</span><span class="va">rstrat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = api00 ~ ell + meals + mobility, design = rstrat)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.svrepdesign.default(dstrat)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 820.8873    10.5190  78.038   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell          -0.4806     0.4060  -1.184    0.238    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals        -3.1415     0.2939 -10.691   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility      0.2257     0.4515   0.500    0.618    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for gaussian family taken to be 1029221)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">svyglm</span><span class="op">(</span><span class="va">api00</span><span class="op">~</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">mobility</span>, design<span class="op">=</span><span class="va">rclus2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = api00 ~ ell + meals + mobility, design = rclus2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as.svrepdesign.default(dclus2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 811.4907    37.1474  21.845   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell          -2.0592     1.6177  -1.273    0.211    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals        -1.7772     1.4901  -1.193    0.241    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility      0.3253     0.6307   0.516    0.609    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for gaussian family taken to be 1045388)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## use quasibinomial, quasipoisson to avoid warning messages</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">svyglm</span><span class="op">(</span><span class="va">sch.wide</span><span class="op">~</span><span class="va">ell</span><span class="op">+</span><span class="va">meals</span><span class="op">+</span><span class="va">mobility</span>, design<span class="op">=</span><span class="va">dstrat</span>,</span></span>
<span class="r-in"><span>        family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasibinomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svyglm(formula = sch.wide ~ ell + meals + mobility, design = dstrat, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     family = quasibinomial())</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Survey design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> svydesign(id = ~1, strata = ~stype, weights = ~pw, data = apistrat, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fpc = ~fpc)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  0.835837   0.455626   1.834   0.0681 .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ell         -0.002490   0.013252  -0.188   0.8512  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> meals       -0.003152   0.009199  -0.343   0.7322  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> mobility     0.060897   0.031935   1.907   0.0580 .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for quasibinomial family taken to be 1.108677)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Compare regression and ratio estimation of totals</span></span></span>
<span class="r-in"><span>  <span class="va">api.ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="svyratio.html">svyratio</a></span><span class="op">(</span><span class="op">~</span><span class="va">api.stu</span>,<span class="op">~</span><span class="va">enroll</span>, design<span class="op">=</span><span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">pop</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>enroll<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">$</span><span class="va">enroll</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">npop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">api.ratio</span>, <span class="va">pop</span><span class="op">$</span><span class="va">enroll</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          enroll</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api.stu 3190038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           enroll</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api.stu 29565.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## regression estimator is less efficient</span></span></span>
<span class="r-in"><span>  <span class="va">api.reg</span> <span class="op">&lt;-</span> <span class="fu">svyglm</span><span class="op">(</span><span class="va">api.stu</span><span class="op">~</span><span class="va">enroll</span>, design<span class="op">=</span><span class="va">dstrat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">api.reg</span>, newdata<span class="op">=</span><span class="va">pop</span>, total<span class="op">=</span><span class="va">npop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      link    SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 3187252 31072</span>
<span class="r-in"><span>  <span class="co">## same as calibration estimator</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">api.stu</span>, <span class="fu"><a href="calibrate.html">calibrate</a></span><span class="op">(</span><span class="va">dstrat</span>, <span class="op">~</span><span class="va">enroll</span>, pop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">npop</span>, <span class="va">pop</span><span class="op">$</span><span class="va">enroll</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           total    SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api.stu 3187252 31072</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## svyglm can also reproduce the ratio estimator</span></span></span>
<span class="r-in"><span>  <span class="va">api.reg2</span> <span class="op">&lt;-</span> <span class="fu">svyglm</span><span class="op">(</span><span class="va">api.stu</span><span class="op">~</span><span class="va">enroll</span><span class="op">-</span><span class="fl">1</span>, design<span class="op">=</span><span class="va">dstrat</span>,</span></span>
<span class="r-in"><span>                    family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasi</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span>,var<span class="op">=</span><span class="st">"mu"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">api.reg2</span>, newdata<span class="op">=</span><span class="va">pop</span>, total<span class="op">=</span><span class="va">npop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      link    SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 3190038 29566</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## higher efficiency by modelling variance better</span></span></span>
<span class="r-in"><span>  <span class="va">api.reg3</span> <span class="op">&lt;-</span> <span class="fu">svyglm</span><span class="op">(</span><span class="va">api.stu</span><span class="op">~</span><span class="va">enroll</span><span class="op">-</span><span class="fl">1</span>, design<span class="op">=</span><span class="va">dstrat</span>,</span></span>
<span class="r-in"><span>                    family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasi</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"identity"</span>,var<span class="op">=</span><span class="st">"mu^3"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">api.reg3</span>, newdata<span class="op">=</span><span class="va">pop</span>, total<span class="op">=</span><span class="va">npop</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      link    SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 3247986 21129</span>
<span class="r-in"><span>  <span class="co">## true value</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">apipop</span><span class="op">$</span><span class="va">api.stu</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3196602</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> </span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

