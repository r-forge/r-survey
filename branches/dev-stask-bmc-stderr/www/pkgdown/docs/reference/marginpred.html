<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Standardised predictions (predictive margins) for regression models. — marginpred • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Standardised predictions (predictive margins) for regression models. — marginpred"><meta property="og:description" content="Reweights the design (using calibrate) so that the adjustment variables are uncorrelated
with the variables in the model, and then performs predictions by
calling predict.  When the adjustment model is saturated this is
equivalent to direct standardization on the adjustment variables.
The svycoxph and svykmlist methods return survival curves."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Standardised predictions (predictive margins) for regression models.</h1>
    
    <div class="hidden name"><code>marginpred.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Reweights the design (using <code><a href="calibrate.html">calibrate</a></code>) so that the adjustment variables are uncorrelated
with the variables in the model, and then performs predictions by
calling <code>predict</code>.  When the adjustment model is saturated this is
equivalent to direct standardization on the adjustment variables.</p>
<p>The <code>svycoxph</code> and <code>svykmlist</code> methods return survival curves.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">marginpred</span><span class="op">(</span><span class="va">model</span>, <span class="va">adjustfor</span>, <span class="va">predictat</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svycoxph</span></span>
<span><span class="fu">marginpred</span><span class="op">(</span><span class="va">model</span>, <span class="va">adjustfor</span>, <span class="va">predictat</span>, se<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svykmlist</span></span>
<span><span class="fu">marginpred</span><span class="op">(</span><span class="va">model</span>, <span class="va">adjustfor</span>, <span class="va">predictat</span>, se<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyglm</span></span>
<span><span class="fu">marginpred</span><span class="op">(</span><span class="va">model</span>, <span class="va">adjustfor</span>, <span class="va">predictat</span>,  <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>model</dt>
<dd><p>A regression model object of a class that has a <code>marginpred</code> method</p></dd>

  <dt>adjustfor</dt>
<dd><p>Model formula specifying adjustment variables, which must be in the
    design object of the model</p></dd>

  <dt>predictat</dt>
<dd><p>A data frame giving values of the variables in <code>model</code> to
    predict at</p></dd>

  <dt>se</dt>
<dd><p>Estimate standard errors for the survival curve (uses a lot
    of memory if the sample size is large)</p></dd>

  <dt>...</dt>
<dd><p>Extra arguments, passed to the <code>predict</code> method for <code>model</code></p></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="svypredmeans.html">svypredmeans</a></code> for the method of Graubard and Korn implemented in SUDAAN.</p>
<p><code><a href="calibrate.html">calibrate</a></code></p>
<p><code><a href="svycoxph.html">predict.svycoxph</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## generate data with apparent group effect from confounding</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">time</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">status</span><span class="op">&lt;-</span><span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">&lt;-</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">x</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span></span></span>
<span class="r-in"><span><span class="va">des</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="fl">1</span>,data<span class="op">=</span><span class="va">df</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No weights or probabilities supplied, assuming equal probability</span>
<span class="r-in"><span><span class="va">newdf</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>,<span class="cn">TRUE</span><span class="op">)</span>, x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Cox model</span></span></span>
<span class="r-in"><span><span class="va">m0</span><span class="op">&lt;-</span><span class="fu"><a href="svycoxph.html">svycoxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">group</span>,design<span class="op">=</span><span class="va">des</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m1</span><span class="op">&lt;-</span><span class="fu"><a href="svycoxph.html">svycoxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">group</span><span class="op">+</span><span class="va">x</span>,design<span class="op">=</span><span class="va">des</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## conditional predictions, unadjusted and adjusted</span></span></span>
<span class="r-in"><span><span class="va">cpred0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m0</span>, type<span class="op">=</span><span class="st">"curve"</span>, newdata<span class="op">=</span><span class="va">newdf</span>, se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cpred1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m1</span>, type<span class="op">=</span><span class="st">"curve"</span>, newdata<span class="op">=</span><span class="va">newdf</span>, se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## adjusted marginal prediction</span></span></span>
<span class="r-in"><span><span class="va">mpred</span><span class="op">&lt;-</span><span class="fu">marginpred</span><span class="op">(</span><span class="va">m0</span>, adjustfor<span class="op">=</span><span class="op">~</span><span class="va">x</span>, predictat<span class="op">=</span><span class="va">newdf</span>, se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cpred0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">cpred1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">cpred1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mpred</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">mpred</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="marginpred-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Kaplan--Meier</span></span></span>
<span class="r-in"><span><span class="va">s2</span><span class="op">&lt;-</span><span class="fu"><a href="svykm.html">svykm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">~</span><span class="va">group</span>, design<span class="op">=</span><span class="va">des</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p2</span><span class="op">&lt;-</span><span class="fu">marginpred</span><span class="op">(</span><span class="va">s2</span>, adjustfor<span class="op">=</span><span class="op">~</span><span class="va">x</span>, predictat<span class="op">=</span><span class="va">newdf</span>,se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">p2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">p2</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="marginpred-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## logistic regression</span></span></span>
<span class="r-in"><span><span class="va">logisticm</span> <span class="op">&lt;-</span> <span class="fu"><a href="svyglm.html">svyglm</a></span><span class="op">(</span><span class="va">group</span><span class="op">~</span><span class="va">time</span>, family<span class="op">=</span><span class="va">quasibinomial</span>, design<span class="op">=</span><span class="va">des</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">newdf</span><span class="op">$</span><span class="va">time</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">logisticpred</span> <span class="op">&lt;-</span> <span class="fu">marginpred</span><span class="op">(</span><span class="va">logisticm</span>, adjustfor<span class="op">=</span><span class="op">~</span><span class="va">x</span>, predictat<span class="op">=</span><span class="va">newdf</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

