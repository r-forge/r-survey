<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Post-stratify a survey — postStratify • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Post-stratify a survey — postStratify"><meta property="og:description" content="Post-stratification adjusts the sampling and replicate weights so that
 the joint distribution of a set of post-stratifying variables matches
 the known population joint distribution. Use rake when
 the full joint distribution is not available."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Post-stratify a survey</h1>
    
    <div class="hidden name"><code>postStratify.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Post-stratification adjusts the sampling and replicate weights so that
 the joint distribution of a set of post-stratifying variables matches
 the known population joint distribution. Use <code><a href="rake.html">rake</a></code> when
 the full joint distribution is not available.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">postStratify</span><span class="op">(</span><span class="va">design</span>, <span class="va">strata</span>, <span class="va">population</span>, partial <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for svyrep.design</span></span>
<span><span class="fu">postStratify</span><span class="op">(</span><span class="va">design</span>, <span class="va">strata</span>, <span class="va">population</span>, partial <span class="op">=</span> <span class="cn">FALSE</span>, compress<span class="op">=</span><span class="cn">NULL</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for survey.design</span></span>
<span><span class="fu">postStratify</span><span class="op">(</span><span class="va">design</span>, <span class="va">strata</span>, <span class="va">population</span>, partial <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>design</dt>
<dd><p>A survey design with replicate weights</p></dd>

  <dt>strata</dt>
<dd><p>A formula or data frame of post-stratifying variables, which must not contain missing values.</p></dd>

  <dt>population</dt>
<dd><p>A <code><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></code>, <code><a href="https://rdrr.io/r/stats/xtabs.html" class="external-link">xtabs</a></code> or <code>data.frame</code>
    with population frequencies</p></dd>

  <dt>partial</dt>
<dd><p>if <code>TRUE</code>, ignore population strata not present in
    the sample</p></dd>

  <dt>compress</dt>
<dd><p>Attempt to compress the replicate weight matrix? When
    <code>NULL</code> will attempt to compress if the original weight matrix
    was compressed</p></dd>

  <dt>...</dt>
<dd><p>arguments for future expansion</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The <code>population</code> totals can be specified as a table with the
  strata variables in the margins, or as a data frame where one column
  lists frequencies and the other columns list the unique combinations
  of strata variables (the format produced by <code>as.data.frame</code>
  acting on a <code>table</code> object).   A table must have named dimnames
  to indicate the variable names.</p>  
<p>Compressing the replicate weights will take time and may even
  increase memory use if there is actually little redundancy in the
  weight matrix (in particular if the post-stratification variables have
  many values and cut  across PSUs).</p>  
<p>If a <code>svydesign</code> object is to be converted to a replication
  design the post-stratification should be performed after conversion.</p> 
  
<p>The variance estimate for replication designs follows the same
  procedure as Valliant (1993) described for estimating totals. Rao et
  al (2002) describe this procedure for estimating functions (and also
  the GREG or g-calibration procedure, see <code><a href="calibrate.html">calibrate</a></code>)</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>If the sampling weights are already post-stratified there will be no
  change in point estimates after <code>postStratify</code> but the standard
  error estimates will decrease to correctly reflect the post-stratification.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>A new survey design object.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Valliant R (1993) Post-stratification and conditional variance
estimation. JASA 88: 89-96</p>  
<p>Rao JNK, Yung W, Hidiroglou MA (2002)   Estimating equations for the
analysis of survey data using poststratification information. Sankhya
64 Series A Part 2, 364-378.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="rake.html">rake</a></code>, <code><a href="calibrate.html">calibrate</a></code> for other things to do
  with auxiliary information</p>  
<p><code><a href="compressWeights.html">compressWeights</a></code> for information on compressing weights</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dclus1</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span>, fpc<span class="op">=</span><span class="op">~</span><span class="va">fpc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rclus1</span><span class="op">&lt;-</span><span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">dclus1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">api00</span>, <span class="va">rclus1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 644.17 26.329</span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">enroll</span>, <span class="va">rclus1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          total     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3404940 932235</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># post-stratify on school type</span></span></span>
<span class="r-in"><span><span class="va">pop.types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>stype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"E"</span>,<span class="st">"H"</span>,<span class="st">"M"</span><span class="op">)</span>, Freq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4421</span>,<span class="fl">755</span>,<span class="fl">1018</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#or: pop.types &lt;- xtabs(~stype, data=apipop)</span></span></span>
<span class="r-in"><span><span class="co">#or: pop.types &lt;- table(stype=apipop$stype)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rclus1p</span><span class="op">&lt;-</span><span class="fu">postStratify</span><span class="op">(</span><span class="va">rclus1</span>, <span class="op">~</span><span class="va">stype</span>, <span class="va">pop.types</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call: postStratify(rclus1, ~stype, pop.types)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unstratified cluster jacknife (JK1) with 15 replicates.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Variables: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "cds"      "stype"    "name"     "sname"    "snum"     "dname"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "dnum"     "cname"    "cnum"     "flag"     "pcttest"  "api00"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "api99"    "target"   "growth"   "sch.wide" "comp.imp" "both"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "awards"   "meals"    "ell"      "yr.rnd"   "mobility" "acs.k3"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "acs.46"   "acs.core" "pct.resp" "not.hsg"  "hsg"      "some.col"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "col.grad" "grad.sch" "avg.ed"   "full"     "emer"     "enroll"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] "api.stu"  "fpc"      "pw"      </span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">api00</span>, <span class="va">rclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 642.31 26.934</span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">enroll</span>, <span class="va">rclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          total     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3680893 473431</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## and for svydesign objects</span></span></span>
<span class="r-in"><span><span class="va">dclus1p</span><span class="op">&lt;-</span><span class="fu">postStratify</span><span class="op">(</span><span class="va">dclus1</span>, <span class="op">~</span><span class="va">stype</span>, <span class="va">pop.types</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 - level Cluster Sampling design</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> With (15) clusters.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> postStratify(dclus1, ~stype, pop.types)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Probabilities:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.01854 0.03257 0.03257 0.03040 0.03257 0.03257 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Population size (PSUs): 757 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data variables:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "cds"      "stype"    "name"     "sname"    "snum"     "dname"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "dnum"     "cname"    "cnum"     "flag"     "pcttest"  "api00"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "api99"    "target"   "growth"   "sch.wide" "comp.imp" "both"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "awards"   "meals"    "ell"      "yr.rnd"   "mobility" "acs.k3"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "acs.46"   "acs.core" "pct.resp" "not.hsg"  "hsg"      "some.col"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "col.grad" "grad.sch" "avg.ed"   "full"     "emer"     "enroll"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] "api.stu"  "fpc"      "pw"      </span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">api00</span>, <span class="va">dclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean    SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> api00 642.31 23.92</span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svytotal</a></span><span class="op">(</span><span class="op">~</span><span class="va">enroll</span>, <span class="va">dclus1p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          total     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 3680893 406293</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

