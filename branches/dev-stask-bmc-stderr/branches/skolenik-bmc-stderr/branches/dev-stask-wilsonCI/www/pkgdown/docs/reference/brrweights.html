<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute replicate weights — brrweights • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute replicate weights — brrweights"><meta property="og:description" content="Compute replicate weights from a survey design. These functions are
  usually called from as.svrepdesign rather than directly
  by the user."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute replicate weights</h1>
    
    <div class="hidden name"><code>brrweights.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Compute replicate weights from a survey design. These functions are
  usually called from <code><a href="as.svrepdesign.html">as.svrepdesign</a></code> rather than directly
  by the user.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brrweights</span><span class="op">(</span><span class="va">strata</span>, <span class="va">psu</span>, match <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>              small <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fail"</span>,<span class="st">"split"</span>,<span class="st">"merge"</span><span class="op">)</span>,</span>
<span>              large <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"split"</span>, <span class="st">"merge"</span>, <span class="st">"fail"</span><span class="op">)</span>,</span>
<span>              fay.rho<span class="op">=</span><span class="fl">0</span>, only.weights<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>              compress<span class="op">=</span><span class="cn">TRUE</span>, hadamard.matrix<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu">jk1weights</span><span class="op">(</span><span class="va">psu</span>,fpc<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              fpctype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"population"</span>,<span class="st">"fraction"</span>,<span class="st">"correction"</span><span class="op">)</span>,</span>
<span>              compress<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">jknweights</span><span class="op">(</span><span class="va">strata</span>,<span class="va">psu</span>, fpc<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>              fpctype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"population"</span>,<span class="st">"fraction"</span>,<span class="st">"correction"</span><span class="op">)</span>,</span>
<span>              compress<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>              lonely.psu<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"survey.lonely.psu"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>strata</dt>
<dd><p>Stratum identifiers</p></dd>

  <dt>psu</dt>
<dd><p>PSU (cluster) identifier</p></dd>

  <dt>match</dt>
<dd><p>Optional variable to use in matching.</p></dd>

  <dt>small</dt>
<dd><p>How to handle strata with only one PSU</p></dd>

  <dt>large</dt>
<dd><p>How to handle strata with more than two PSUs</p></dd>

  <dt>fpc</dt>
<dd><p>Optional population (stratum) size or finite population correction</p></dd>

  <dt>fpctype</dt>
<dd><p>How <code>fpc</code> is coded.</p></dd>

  <dt>fay.rho</dt>
<dd><p>Parameter for Fay's extended BRR method</p></dd>

  <dt>only.weights</dt>
<dd><p>If <code>TRUE</code> return only the matrix of
    replicate weights</p></dd>

  <dt>compress</dt>
<dd><p>If <code>TRUE</code>, store the replicate weights in
    compressed form</p></dd>

  <dt>hadamard.matrix</dt>
<dd><p>Optional user-supplied Hadamard matrix for
    <code>brrweights</code></p></dd>

  <dt>lonely.psu</dt>
<dd><p>Handling of non-certainty single-PSU strata</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>JK1 and JKn are  jackknife schemes for unstratified and stratified
  designs respectively.  The finite population correction may be
  specified as a single number, a vector with one entry per stratum, or
  a vector with one entry per observation (constant within strata). 
  When <code>fpc</code> is a vector with one entry per stratum it may not have
  names that differ from the stratum identifiers (it may have no names,
  in which case it must be in the same order as
  <code>unique(strata)</code>). To specify population stratum sizes use
  <code>fpctype="population"</code>, to specify sampling fractions use
  <code>fpctype="fraction"</code> and to specify the correction directly use
  <code>fpctype="correction"</code></p>  
<p>The only reason not to use <code>compress=TRUE</code> is that it is new and
  there is a greater possibility of bugs.  It reduces the number of
  rows of the replicate weights matrix from the number of observations
  to the number of PSUs.</p>  
<p>In BRR variance estimation each stratum is split in two to give
  half-samples. Balanced replicated weights are needed, where
  observations in two different strata end up in the same half stratum
  as often as in different half-strata.BRR, strictly speaking, is
  defined only when each stratum has exactly
  two PSUs.  A stratum with one PSU can be merged with another such
  stratum, or can be split to appear in both half samples with half
  weight.  The latter approach is appropriate for a PSU that was
  deterministically sampled.</p>  
<p>A stratum with more than two PSUs can be split into multiple smaller
  strata each with two PSUs or the PSUs can be merged to give two
  superclusters within the stratum.</p>  
<p>When merging small strata or grouping PSUs in large strata the
  <code>match</code> variable is used to sort PSUs before merging, to give
  approximate matching on this variable.</p>  
<p>If you want more control than this you should probably construct your
  own weights using the Hadamard matrices produced by <code><a href="hadamard.html">hadamard</a></code></p>  


    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>For <code>brrweights</code> with <code>only.weights=FALSE</code> a list with elements</p>
<dl><dt>weights</dt>
<dd><p>two-column matrix indicating the weight for each
    half-stratum in one particular set  of split samples</p></dd>

  <dt>wstrata</dt>
<dd><p>New stratum variable incorporating merged or split strata</p></dd>

  <dt>strata</dt>
<dd><p>Original strata for distinct PSUs</p></dd>

  <dt>psu</dt>
<dd><p>Distinct PSUs</p></dd>

  <dt>npairs</dt>
<dd><p>Dimension of Hadamard matrix used in BRR construction</p></dd>

  <dt>sampler</dt>
<dd><p>function returning replicate weights</p></dd>

  <dt>compress</dt>
<dd><p>Indicates whether the <code>sampler</code> returns per PSU
    or per observation weights</p></dd>

</dl><p>For <code>jk1weights</code> and <code>jknweights</code> a data frame of replicate
  weights and the <code>scale</code> and <code>rscale</code> arguments to <code><a href="svrVar.html">svrVar</a></code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Levy and Lemeshow "Sampling of Populations". Wiley.</p>  
<p>Shao and Tu "The Jackknife and Bootstrap". Springer.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="hadamard.html">hadamard</a></code>, <code><a href="as.svrepdesign.html">as.svrepdesign</a></code>,
  <code><a href="svrVar.html">svrVar</a></code>, <code><a href="surveyoptions.html">surveyoptions</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">scd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scdnofpc</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">scd</span>, prob<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, id<span class="op">=</span><span class="op">~</span><span class="va">ambulance</span>, strata<span class="op">=</span><span class="op">~</span><span class="va">ESA</span>,</span></span>
<span class="r-in"><span>nest<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## convert to BRR replicate weights</span></span></span>
<span class="r-in"><span><span class="va">scd2brr</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">scdnofpc</span>, type<span class="op">=</span><span class="st">"BRR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">alive</span>, <span class="va">scd2brr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alive 46.333 3.5824</span>
<span class="r-in"><span><span class="fu"><a href="svyratio.html">svyratio</a></span><span class="op">(</span><span class="op">~</span><span class="va">alive</span>, <span class="op">~</span><span class="va">arrests</span>, <span class="va">scd2brr</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ratio estimator: svyratio.svyrep.design(~alive, ~arrests, scd2brr)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ratios=</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         arrests</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alive 0.1535064</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SEs=</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.009418401</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## with user-supplied hadamard matrix</span></span></span>
<span class="r-in"><span><span class="va">scd2brr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="as.svrepdesign.html">as.svrepdesign</a></span><span class="op">(</span><span class="va">scdnofpc</span>, type<span class="op">=</span><span class="st">"BRR"</span>, hadamard.matrix<span class="op">=</span><span class="fu"><a href="paley.html">paley</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">alive</span>, <span class="va">scd2brr1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alive 46.333 3.5824</span>
<span class="r-in"><span><span class="fu"><a href="svyratio.html">svyratio</a></span><span class="op">(</span><span class="op">~</span><span class="va">alive</span>, <span class="op">~</span><span class="va">arrests</span>, <span class="va">scd2brr1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ratio estimator: svyratio.svyrep.design(~alive, ~arrests, scd2brr1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ratios=</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         arrests</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alive 0.1535064</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SEs=</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.01001468</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

