<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Crossed effects and other sparse correlations — xdesign • survey</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Crossed effects and other sparse correlations — xdesign"><meta property="og:description" content="Defines a design object with multiple dimensions of correlation:
  observations that share any of the id variables are correlated,
  or you can supply an adjacency matrix or Matrix to specify which are
  correlated. Supports crossed designs (eg multiple raters of multiple
  objects) and non-nested observational correlation (eg observations
  sharing primary school or secondary school). Has methods for
  svymean, svytotal, svyglm (so far)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">survey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Crossed effects and other sparse correlations</h1>
    
    <div class="hidden name"><code>xdesign.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Defines a design object with multiple dimensions of correlation:
  observations that share any of the <code>id</code> variables are correlated,
  or you can supply an adjacency matrix or Matrix to specify which are
  correlated. Supports crossed designs (eg multiple raters of multiple
  objects) and non-nested observational correlation (eg observations
  sharing primary school or secondary school). Has methods for
  <code>svymean</code>, <code>svytotal</code>, <code>svyglm</code> (so far).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">xdesign</span><span class="op">(</span>id <span class="op">=</span> <span class="cn">NULL</span>, strata <span class="op">=</span> <span class="cn">NULL</span>, weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">data</span>, fpc <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>adjacency <span class="op">=</span> <span class="cn">NULL</span>, overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unbiased"</span>, <span class="st">"positive"</span><span class="op">)</span>, allow.non.binary <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>id</dt>
<dd><p>list of formulas specifying cluster identifiers for each clustering dimension (or <code>NULL</code>)</p></dd>

  <dt>strata</dt>
<dd><p>Not implemented</p></dd>

  <dt>weights</dt>
<dd><p>model formula specifying (sampling) weights</p></dd>

  <dt>data</dt>
<dd><p>data frame containing all the variables</p></dd>

  <dt>fpc</dt>
<dd><p>Not implemented</p></dd>

  <dt>adjacency</dt>
<dd><p>Adjacency matrix or Matrix indicating which pairs of observations
    are correlated</p></dd>

  <dt>overlap</dt>
<dd><p>See details below</p></dd>

  <dt>allow.non.binary</dt>
<dd>

<p>If <code>FALSE</code> check that <code>adjacency</code> is a binary 0/1 or
    <code>TRUE</code>/<code>FALSE</code> matrix or Matrix.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Subsetting for these objects actually drops observations; it is not
    equivalent to just setting weights to zero as for survey
    designs. So, for example, a subset of a balanced design will not be
    a balanced design.</p>  
<p>The <code>overlap</code> option controls double-counting of some variance
    terms. Suppose there are two clustering dimensions, <code>~a</code> and
    <code>~b</code>. If we compute variance matrices clustered on <code>a</code> and
    clustered on <code>b</code> and add them, observations that share both
    <code>a</code> and <code>b</code> will be counted twice, giving a positively
    biased estimator.  We can subtract off a variance matrix clustered
    on combinations of <code>a</code> and <code>b</code> to give an unbiased
    variance estimator.  However, the unbiased estimator is not
    guaranteed to be positive definite. In the references, Miglioretti
    and Heagerty use the <code>overlap="positive"</code> estimator and Cameron
    et al use the <code>overlap="unbiased"</code> estimator.</p>
  

    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>xdesign</code></p>


    </div>
    <div id="references">
    <h2>References</h2>
    <p>Miglioretti D, Heagerty PJ (2007) Marginal modeling of nonnested
multilevel data using standard software. Am J Epidemiol 165(4):453-63</p>
<p>Cameron, A. C., Gelbach, J. B., &amp; Miller, D. L. (2011). Robust Inference
With Multiway Clustering. Journal of Business &amp; Economic Statistics,
29(2), 238-249.</p>
<p><a href="https://notstatschat.rbind.io/2021/09/18/crossed-clustering-and-parallel-invention/" class="external-link">https://notstatschat.rbind.io/2021/09/18/crossed-clustering-and-parallel-invention/</a></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="salamander.html">salamander</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With one clustering dimension, is close to the with-replacement</span></span></span>
<span class="r-in"><span><span class="co">##   survey estimator, but not identical unless clusters are equal size</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">api</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dclus1r</span><span class="op">&lt;-</span><span class="fu"><a href="svydesign.html">svydesign</a></span><span class="op">(</span>id<span class="op">=</span><span class="op">~</span><span class="va">dnum</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xclus1</span><span class="op">&lt;-</span><span class="fu">xdesign</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">dnum</span><span class="op">)</span>, weights<span class="op">=</span><span class="op">~</span><span class="va">pw</span>, data<span class="op">=</span><span class="va">apiclus1</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>only one clustering dimension?</span>
<span class="r-in"><span><span class="va">xclus1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1-way crossed design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xdesign(id = list(~dnum), weights = ~pw, data = apiclus1)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">enroll</span>,<span class="va">dclus1r</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 549.72 45.646</span>
<span class="r-in"><span><span class="fu"><a href="surveysummary.html">svymean</a></span><span class="op">(</span><span class="op">~</span><span class="va">enroll</span>,<span class="va">xclus1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          mean     SE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> enroll 549.72 46.964</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">salamander</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xsalamander</span><span class="op">&lt;-</span><span class="fu">xdesign</span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">~</span><span class="va">Male</span>, <span class="op">~</span><span class="va">Female</span><span class="op">)</span>, data<span class="op">=</span><span class="va">salamander</span>,</span></span>
<span class="r-in"><span>    overlap<span class="op">=</span><span class="st">"unbiased"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xsalamander</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2-way crossed design:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> xdesign(id = list(~Male, ~Female), data = salamander, overlap = "unbiased")</span>
<span class="r-in"><span><span class="fu"><a href="svychisq.html">degf</a></span><span class="op">(</span><span class="va">xsalamander</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 32.72727</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by “Thomas Lumley”.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

